/*! custup 2023-12-09 */
import CustUpCore from"../core/custupCore.js";import _customStyles from"../utils/_customStyles.js";import file_types from"../utils/filetypes.js";export default class CustUp extends CustUpCore{constructor(e){super(e),this.uiSelect()}uiSelect(){switch(this.options.ui_type){case"resumeUploaderUI":this.resumeUploaderUI();break;case"bare":this.bareUploaderUI();break;case"detached":this.detachedUploaderUI();break;case"profilePicture":this.profilePictureUI()}this.map_override_styles_to_default_styles(this.options.default_styles_override),this.options.autoInitialize&&this.initializeUI()}resumeUploaderUI(){this.map_override_styles_to_default_styles({outerContainer:["RUIOuterContainer",!0],defaultUI:["RUIDefaultUIEl",!0],defaultUIUploadIconsContainer:["RUIDefaultUIUploadIconsContainer",!0]}),this.options.allowed_sources=null,this.options._custupDefaultUploadSentence=`<div style="color: gray; line-height: 30px; pointer-events: none;">
            <div><b style="color: black;">Upload a file</b> or drag and drop here</div>
            <div>Accepted Files: ${0==this.options.allowed_file_types.length?"All":this.options.allowed_file_types.join(", ").toUpperCase()}
            Up to ${this.parseFileSize(this.options.maximumAllowedFileSize)}
            </div>
        </div>`,(this.options.allowed_tools=null)===document.querySelector("[href*='resumeUploaderUI.']")&&console.warn(this.libraryName+": Please include the resumeUploaderUI css file")}bareUploaderUI(){this.map_override_styles_to_default_styles({outerContainer:["BareUIOuterContainer",!0],innerContainer:["BareUIInnerContainer",!0],defaultUI:["BareUIDefaultUIEl",!0],defaultUIUploadIconsContainer:["BareUIDefaultUIUploadIconsContainer",!0]}),this.options.allowed_tools=null,this.options.allowed_sources=null,this.options.disable_scrollbar=!0;var e=document.createElement("div"),t=document.createElement("div"),n=(t.className="BareUIDefaultUIInnerContent",document.createElement("div")),o=(n.style.width="50px",n.style.height="50px",n.innerHTML=this.ui_icons.upload_circle,document.createElement("div")),l=(o.innerHTML='<b style="color: black;">Drop files here</b>',document.createElement("div"));l.className="BareUIDefaultUIInnerContentLastItem",l.innerHTML="or <span>Select files</span>",t.appendChild(n),t.appendChild(o),t.appendChild(l),e.appendChild(t),this.options._custupDefaultUploadSentence=e.innerHTML,null===document.querySelector("[href*='bare.']")&&console.warn(this.libraryName+": Please include the bare css file")}detachedUploaderUI(){this.options.use_default_file_display_ui=!1,this.options.persist_default_ui=!0,this.options.allowed_sources=null;var e=document.createElement("div"),t=document.createElement("div"),n=(t.style.lineHeight="30px",document.createElement("div")),o=(n.innerHTML=this.ui_icons.unknown_file,n.className="DUIIconContainer",document.createElement("div")),l=(o.innerHTML="Drag and drop your files here",o.className="DUITextContainer1",document.createElement("div"));l.innerHTML="or Click to browse from your computer",t.appendChild(n),t.appendChild(o),t.appendChild(l),e.append(t),this.options._custupDefaultUploadSentence=e.innerHTML;const a=document.createElement("div"),i=(a.className="DUIBottomButtonContainer",document.createElement("button")),r=(i.className="DUIUploadButton",i.innerHTML="Upload",i.type="button",i.onclick=()=>this.upload(),document.createElement("button"));r.className="DUIClearButton",r.innerHTML="Clear",r.type="button",r.onclick=()=>{this.clear_files(),a.style.display="none",this._custupFooterEl.querySelector(".inner").innerHTML=""};n=0==this.options.allowed_tools?.length||this.options.allowed_tools?.includes("clear_files"),o=0==this.options.allowed_tools?.length||this.options.allowed_tools?.includes("upload");n&&a.appendChild(r),o&&a.appendChild(i),this.map_override_styles_to_default_styles({outerContainer:["DUIOuterContainer",!0],innerContainer:["DUIInnerContainer",!0],custupInnerContainerWrapperEl:["DUIInnerContainerWrapper",!0],defaultUI:["DUIDefaultUI",!0],footerContainer:"DUIFooterContainer",headerContainer:"DUIHeaderContainer",file_wrapper_el:"DHIFileInnerWrapper"}),this.on("file.beforeAdded",e=>{const t=document.createElement("div");t.style.width="100%",t.className="DUIFileContainer",t.id=e.file.id;var n=document.createElement("div"),o=(n.className="DHIFilePreviewEl",this.makeFileDisplayElement(e.file,n,e.base64),document.createElement("div")),l=(o.className="DHIFileDetails",document.createElement("div")),i=(l.className="DHITextContainer",document.createElement("div")),r=document.createElement("div"),i=(r.className="DHIProgressText",i.innerHTML=this.clipFileNameIfShouldClip(e.file.name),l.appendChild(i),l.appendChild(r),document.createElement("div")),r=(i.className="DHIUploadProgressContainer",document.createElement("div")),s=(r.className="DHIMainProgress",document.createElement("div")),r=(s.className="DHIProgressInner",r.appendChild(s),i.appendChild(r),s.style.width="0%",o.appendChild(l),o.appendChild(i),document.createElement("div"));r.className="DHICloseBtnContainer",r.innerHTML=this.ui_icons.red_circle_cancel,r.onclick=()=>this.remove_file(e.file.id,()=>t.remove()),t.appendChild(n),t.appendChild(o),t.appendChild(r),this._custupFooterEl.querySelector(".inner").append(t),a.style.display="flex"}),this.on("library.init",()=>{this._custupFooterEl.append(a)}),this.on("file.removed",e=>{0==e.files_count&&(a.style.display="none")}),this.on("upload.beforeStart",()=>{i.disabled=!0,r.disabled=!0,i.innerHTML="Uploading..."}),this.on("upload.success",e=>{i.disabled=!1,r.disabled=!1,i.innerHTML="Upload"}),this.on("upload.error",e=>{i.disabled=!1,r.disabled=!1,i.innerHTML="Upload";var t=this._custupFooterEl.querySelector(".inner").querySelector("div.DUIFileContainer#"+e.file.id),t=(t.querySelector(".DHIUploadProgressContainer").querySelector(".DHIProgressInner").style.backgroundColor="red",t.querySelector(".DHIProgressText")),n=document.createElement("div");n.className="DHIRetryButton",n.innerHTML="Retry",n.onclick=()=>this.retry_upload(e.file.id),this.options.single_upload||(t.innerHTML=""),this.options.single_upload||t.append(n)}),this.on("upload.progress",e=>{var t=this._custupFooterEl.querySelector(".inner").querySelector("div.DUIFileContainer#"+e.file.id),n=t.querySelector(".DHIUploadProgressContainer"),t=(n.style.display="flex",t.querySelector(".DHIProgressText")),n=n.querySelector(".DHIProgressInner"),o=(n.style.backgroundColor="rgb(39, 39, 148)",e.progressEvent.loaded/e.progressEvent.total*100+"%");n.style.width=o,t.innerHTML=o,e.progressEvent.loaded>=e.progressEvent.total&&(n.style.backgroundColor="green")}),null===document.querySelector("[href*='detached.']")&&console.warn(this.libraryName+": Please include the detached css file")}profilePictureUI(){this.options.allowed_sources=null,this.options.display_ui_tools=!1,this.options.disable_scrollbar=!0,this.options.minNumberOfFiles=1,this.options.maxNumberOfFiles=1,this.options.show_file_remove_btn=!1,this.options.show_file_details_container=!1,this.options.allowed_file_types=["jpg","png","jpeg","jpg"],this.map_override_styles_to_default_styles({outerContainer:["PPUIOuterContainer",!0],innerContainer:["PPUIInnerContainer",!0],custupInnerContainerWrapperEl:["PPUIInnerContainerWrapper",!0],fileDisplayUI:["PPUIFileDisplayUI",!0],fileUIOuterContainer:["PPUIFileUIOuter",!0],fileUI:["PPUIFileUI",!0],defaultUI:["PPUIDefaultUI",!0],footerContainer:"PPUIFooterContainer"});var e=document.createElement("div"),t=(e.className="PPUIDefaultUIInner",document.createElement("div")),n=(t.className="PPUIDefaultUIInnerIcon",t.innerHTML=this.ui_icons.plus,document.createElement("div"));n.innerHTML="Upload Profile Picture",e.appendChild(t),e.appendChild(n),this.options._custupDefaultUploadSentence=e.innerHTML;const o=document.createElement("div");o.className="PPUIButtonToolsContainer";var t=document.createElement("button"),n=(t.className="PPUIUploadBtn",t.innerHTML="Upload",t.type="button",t.onclick=()=>this.upload(),document.createElement("button")),e=(n.className="PPUIClearBtn",n.type="button",n.innerHTML="Clear",n.onclick=()=>this.clear_files(),0==this.options.allowed_tools?.length||this.options.allowed_tools?.includes("clear_files")),l=0==this.options.allowed_tools?.length||this.options.allowed_tools?.includes("upload");e&&o.appendChild(n),l&&o.appendChild(t),this.on("file.afterAdded",()=>{this._custupFooterEl.querySelector(".inner").append(o)}),this.on("file.all_removed",()=>{this._custupFooterEl.querySelector(".inner").innerHTML=""}),null===document.querySelector("[href*='profilePicture.']")&&console.warn(this.libraryName+": Please include the profilePicture css file")}}