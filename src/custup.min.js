/*! custup 2024-02-11 */
import CustUpCore from"../core/custupCore.js";import _customStyles from"../utils/_customStyles.js";import file_types from"../utils/filetypes.js";export default class CustUp extends CustUpCore{constructor(e){super(e),this.uiSelect()}uiSelect(){switch(this.options.ui_type){case"resumeUploaderUI":this.resumeUploaderUI();break;case"bare":this.bareUploaderUI();break;case"detached":this.detachedUploaderUI();break;case"profilePicture":this.profilePictureUI();break;case"elegant":this.elegantUI()}this.map_override_styles_to_default_styles(this.options.default_styles_override),this.options.autoInitialize&&this.initializeUI()}resumeUploaderUI(){this.map_override_styles_to_default_styles({outerContainer:["RUIOuterContainer",!0],defaultUI:["RUIDefaultUIEl",!0],defaultUIUploadIconsContainer:["RUIDefaultUIUploadIconsContainer",!0]}),this.options.display_file_sources=!1,this.options._custupDefaultUploadSentence=`<div style="color: gray; line-height: 30px; pointer-events: none;">
            <div><b style="color: black;">Upload a file</b> or drag and drop here</div>
            <div>Accepted Files: ${0==this.options.allowed_file_types.length?"All":this.options.allowed_file_types.join(", ").toUpperCase()}
            Up to ${this.parseFileSize(this.options.maximumAllowedFileSize)}
            </div>
        </div>`,(this.options.allowed_tools=null)===document.querySelector("[href*='all.min.']")&&null===document.querySelector("[href*='resumeUploaderUI.']")&&console.warn(this.libraryName+": Please include the resumeUploaderUI css file")}bareUploaderUI(){this.map_override_styles_to_default_styles({outerContainer:["BareUIOuterContainer",!0],innerContainer:["BareUIInnerContainer",!0],defaultUI:["BareUIDefaultUIEl",!0],defaultUIUploadIconsContainer:["BareUIDefaultUIUploadIconsContainer",!0]}),this.options.allowed_tools=null,this.options.display_file_sources=!1,this.options.disable_scrollbar=!0;var e=document.createElement("div"),t=document.createElement("div"),i=(t.className="BareUIDefaultUIInnerContent",document.createElement("div")),n=(i.style.width="50px",i.style.height="50px",i.innerHTML=this.ui_icons.upload_circle,document.createElement("div")),l=(n.innerHTML='<b style="color: black;">Drop files here</b>',document.createElement("div"));l.className="BareUIDefaultUIInnerContentLastItem",l.innerHTML="or <span>Select files</span>",t.appendChild(i),t.appendChild(n),t.appendChild(l),e.appendChild(t),this.options._custupDefaultUploadSentence=e.innerHTML,null===document.querySelector("[href*='all.min.']")&&null===document.querySelector("[href*='bare.']")&&console.warn(this.libraryName+": Please include the bare css file")}detachedUploaderUI(){this.options.use_default_file_display_ui=!1,this.options.persist_default_ui=!0,this.options.display_file_sources=!1;var e=document.createElement("div"),t=document.createElement("div"),i=(t.style.lineHeight="30px",document.createElement("div")),n=(i.innerHTML=this.ui_icons.unknown_file,i.className="DUIIconContainer",document.createElement("div")),l=(n.innerHTML="Drag and drop your files here",n.className="DUITextContainer1",document.createElement("div"));l.innerHTML="or Click to browse from your computer",t.appendChild(i),t.appendChild(n),t.appendChild(l),e.append(t),this.options._custupDefaultUploadSentence=e.innerHTML;const d=document.createElement("div"),o=(d.className="DUIBottomButtonContainer",document.createElement("button")),r=(o.className="DUIUploadButton",o.innerHTML="Upload",o.type="button",o.onclick=e=>this.upload(),document.createElement("button"));r.className="DUIClearButton",r.innerHTML="Clear",r.type="button",r.onclick=()=>{this.clear_files(),d.style.display="none",this._custupFooterEl.querySelector(".inner").innerHTML=""};i=0==this.options.allowed_tools?.length||this.options.allowed_tools?.includes("clear_files"),n=0==this.options.allowed_tools?.length||this.options.allowed_tools?.includes("upload");i&&d.appendChild(r),n&&d.appendChild(o),this.map_override_styles_to_default_styles({outerContainer:["DUIOuterContainer",!0],innerContainer:["DUIInnerContainer",!0],custupInnerContainerWrapperEl:["DUIInnerContainerWrapper",!0],defaultUI:["DUIDefaultUI",!0],footerContainer:"DUIFooterContainer",headerContainer:"DUIHeaderContainer",file_wrapper_el:"DHIFileInnerWrapper"}),this.on("file.beforeAdded",e=>{const t=document.createElement("div");t.style.width="100%",t.className="DUIFileContainer",t.id=e.file.id;var i=document.createElement("div"),n=(i.className="DHIFilePreviewEl",this.makeFileDisplayElement(e.file,i,e.base64),document.createElement("div")),l=(n.className="DHIFileDetails",document.createElement("div")),o=(l.className="DHITextContainer",document.createElement("div")),r=document.createElement("div"),s=(r.className="DHIFilesizeContainer",r.innerHTML=this.parseFileSize(e.file.size),document.createElement("div")),o=(s.className="DHIProgressText",o.innerHTML=this.clipFileNameIfShouldClip(e.file.name),l.appendChild(o),l.appendChild(s),document.createElement("div")),s=(o.className="DHIUploadProgressContainer",document.createElement("div")),a=(s.className="DHIMainProgress",document.createElement("div")),s=(a.className="DHIProgressInner",s.appendChild(a),o.appendChild(s),a.style.width="0%",n.appendChild(l),n.appendChild(r),n.appendChild(o),document.createElement("div"));s.className="DHICloseBtnContainer",s.innerHTML=this.ui_icons.red_circle_cancel,s.onclick=()=>this.remove_file(e.file.id,()=>t.remove()),t.appendChild(i),t.appendChild(n),t.appendChild(s),this._custupFooterEl.querySelector(".inner").append(t),d.style.display="flex"}),this.on("library.init",()=>{this._custupFooterEl.append(d)}),this.on("file.removed",e=>{0==e.files_count&&(d.style.display="none")}),this.on("upload.beforeStart",()=>{o.disabled=!0,r.disabled=!0,o.innerHTML="Uploading..."}),this.on("upload.success",e=>{o.disabled=!1,r.disabled=!1,o.innerHTML="Upload"}),this.on("upload.error",e=>{o.disabled=!1,r.disabled=!1,o.innerHTML="Upload";var t=this._custupFooterEl.querySelector(".inner").querySelector("div.DUIFileContainer#"+e.file.id),t=(t.querySelector(".DHIUploadProgressContainer").querySelector(".DHIProgressInner").style.backgroundColor="red",t.querySelector(".DHIProgressText")),i=document.createElement("div");i.className="DHIRetryButton",i.innerHTML="Retry",i.onclick=()=>this.retry_upload(e.file.id),this.options.single_upload||(t.innerHTML=""),this.options.single_upload||t.append(i)}),this.on("upload.progress",e=>{var t,i,n;this.options.single_upload||((i=(t=this._custupFooterEl.querySelector(".inner").querySelector("div.DUIFileContainer#"+e.file.id)).querySelector(".DHIUploadProgressContainer")).style.display="flex",t=t.querySelector(".DHIProgressText"),(i=i.querySelector(".DHIProgressInner")).style.backgroundColor="rgb(39, 39, 148)",n=e.progressEvent.loaded/e.progressEvent.total*100,i.style.width=n+"%",t.innerHTML=100==n?"100%":n.toFixed(1)+"%",e.progressEvent.loaded>=e.progressEvent.total&&(i.style.backgroundColor="green"))}),null===document.querySelector("[href*='all.min.']")&&null===document.querySelector("[href*='detached.']")&&console.warn(this.libraryName+": Please include the detached css file")}profilePictureUI(){this.options.display_file_sources=!1,this.options.display_ui_tools=!1,this.options.disable_scrollbar=!0,this.options.minNumberOfFiles=1,this.options.maxNumberOfFiles=1,this.options.show_file_remove_btn=!1,this.options.show_file_details_container=!1,this.options.allowed_file_types=["jpg","png","jpeg","jpg"],this.map_override_styles_to_default_styles({outerContainer:["PPUIOuterContainer",!0],innerContainer:["PPUIInnerContainer",!0],custupInnerContainerWrapperEl:["PPUIInnerContainerWrapper",!0],fileDisplayUI:["PPUIFileDisplayUI",!0],fileUIOuterContainer:["PPUIFileUIOuter",!0],fileUI:["PPUIFileUI",!0],defaultUI:["PPUIDefaultUI",!0],footerContainer:"PPUIFooterContainer"});var e=document.createElement("div"),t=(e.className="PPUIDefaultUIInner",document.createElement("div")),i=(t.className="PPUIDefaultUIInnerIcon",t.innerHTML=this.ui_icons.plus,document.createElement("div"));i.innerHTML="Upload Profile Picture",e.appendChild(t),e.appendChild(i),this.options._custupDefaultUploadSentence=e.innerHTML;const n=document.createElement("div");n.className="PPUIButtonToolsContainer";var t=document.createElement("button"),i=(t.className="PPUIUploadBtn",t.innerHTML="Upload",t.type="button",t.onclick=()=>this.upload(),document.createElement("button")),e=(i.className="PPUIClearBtn",i.type="button",i.innerHTML="Clear",i.onclick=()=>this.clear_files(),0==this.options.allowed_tools?.length||this.options.allowed_tools?.includes("clear_files")),l=0==this.options.allowed_tools?.length||this.options.allowed_tools?.includes("upload");e&&n.appendChild(i),l&&n.appendChild(t),this.on("file.afterAdded",()=>{this._custupFooterEl.querySelector(".inner").append(n)}),this.on("file.all_removed",()=>{this._custupFooterEl.querySelector(".inner").innerHTML=""}),null===document.querySelector("[href*='all.min.']")&&null===document.querySelector("[href*='profilePicture.']")&&console.warn(this.libraryName+": Please include the profilePicture css file")}elegantUI(){const I=()=>window.screen.width<=768;this.map_override_styles_to_default_styles({outerContainer:["EUIOuterContainer",!0],innerContainer:["EUIInnerContainer",!0],sidebarLeftContainer:["EUISidebarLeftContainer",!0],custupInnerContainerWrapperEl:["EUIInnerContainerWrapper",!0],headerContainer:["EUIHeaderContainer",!0],defaultUI:["EUIDefaultUI",!0],defaultUIInnerContentEl:["EUIDefaultUIInnerContentEl",!0],filePreviewer:["EUIFilePreviewer",!0],fileDisplayUI:["EUIFileDisplayUI",!0],fileUIOuterContainer:["EUIFileUIOuterContainer",!0],fileUI:["EUIFileUIMainContainer",!0],close_popup_btn:["EUIClosePopupBtn",!0],footerContainer:["EUIFooterContainer",!0],footerContainer:"EUIFooterContainer",defaultUIUploadSentenceContainer:["EUIDefaultUIUploadSentenceContainer",!0]}),this.options.display_file_sources=!1,this.options.use_default_file_display_ui=!0,this.options.display_ui_tools=!1,this.options.show_file_remove_btn=!1,this.options.show_file_details_container=!1,this.options.disable_scrollbar=!0,this.options.show_upload_progress_bar=!1,this.options.show_upload_error_overlay=!1,this.options.disable_select_files_from_device=I(),this.options.external_source_style_override={...this.options.external_source_style_override,container:["EUIExternalSourceContainer",!0]},this.options.media_capture_source_style_override={...this.options.media_capture_source_style_override,container:["EUIMediaSourceContainer",!0]},this.options.css_font_name="Roboto-regular, Roboto, sans-serif";var e=document.createElement("div"),t=document.createElement("div"),i=(t.className="EUIDefaultUIFileSelectTip",document.createElement("div")),n=(i.className="EUIFileTipIconContainer",i.innerHTML=this.ui_icons.add_file_filled,document.createElement("div")),l=(n.className="EUIFileTipText1",n.innerHTML="Select Files to Upload",document.createElement("div"));l.className="EUIFileTipText2",l.innerHTML="or Drag and Drop Files",t.appendChild(i),t.appendChild(n),t.appendChild(l),e.appendChild(t),this.options._custupDefaultUploadSentence=e.innerHTML,this.on("library.init",()=>{let d=!1,n=null,l=null;const o=e=>{this.show_add_file_ui(),this._custupEl.querySelectorAll('[data-custup-icon-active="true"]').forEach(e=>e.removeAttribute("data-custup-icon-active")),l&&(l.dataset.custupIconActive="true"),u.innerHTML=null==e?.currentTarget.innerHTML?"Select from":e.currentTarget.innerHTML,h(),t(),this.close_file_source_popup()},r=document.createElement("div"),c=(r.className="EUISelectFileToggleBtn",r.innerHTML=this.ui_icons.bars,r.onclick=e=>{this.is_add_file_ui_shown()&&0<this.get_total_file_count()?this.hide_add_file_ui():(o(),f())},this._custupEl.append(r),()=>{var e=document.createElement("div"),t=document.createElement("button"),t=(t.innerHTML="Deselect All",t.type="button",t.onclick=()=>this.clear_files(),e.appendChild(t),document.createElement("div")),i=document.createElement("button");i.type="button",i.innerHTML="Upload",t.appendChild(i),i.onclick=()=>this.upload(),n=i,this._custupFooterEl.querySelector(".inner").append(e),this._custupFooterEl.querySelector(".inner").append(t),this._custupEl.style.setProperty("--footer-container-height",this._custupFooterEl.clientHeight+"px"),d=!0}),t=()=>{this._custupFooterEl.querySelector(".inner").innerHTML="",this._custupEl.style.setProperty("--footer-container-height",this._custupFooterEl.clientHeight+"px"),d=!1},u=document.createElement("div"),e=(u.className="EUIHeaderTitleBar",this._custupHeaderEl.querySelector(".inner").append(u),u.innerHTML=I()?"Select from":this.ui_icons.desktop_device,document.createElement("div"));e.className="EUIFilterBoxContainer";var i=document.createElement("div"),s=(i.className="EUIFilterBoxInputWrapper",document.createElement("input")),a=(s.placeholder="Filter",s.className="EUIFilterBox",document.createElement("div"));a.innerHTML=this.ui_icons.search_icon,s.onkeyup=e=>{const t=e.currentTarget.value,i=this.get_all_files().filter(e=>-1==e.name.toLowerCase().indexOf(t.toLowerCase()));this.get_all_files().forEach(e=>{""!=t&&i.includes(e)?this._custupEl.querySelector("#"+e.id).style.setProperty("display","none","important"):this._custupEl.querySelector("#"+e.id).style.setProperty("display","flex","important")})},i.appendChild(a),i.appendChild(s),e.appendChild(i),this._custupHeaderEl.querySelector(".inner").append(e);const p=document.createElement("div");p.className="EUIFileStateInfoContainer";a=document.createElement("div");a.className="EUIFileStateInfoContainerText",a.innerHTML="Files",p.appendChild(a),this._custupHeaderEl.querySelector(".inner").append(p);const h=()=>{this._custupHeaderEl.style.setProperty("height","auto","important"),e.style.display="none",p.style.display="none",this._custupEl.style.setProperty("--header-container-height",this._custupHeaderEl.offsetHeight+"px")},_=()=>{this._custupHeaderEl.style.setProperty("height","auto","important"),e.style.display="flex",p.style.display="flex",this._custupEl.style.setProperty("--header-container-height",this._custupHeaderEl.offsetHeight+"px")},m=e=>{this._custupEl.querySelectorAll('[data-custup-icon-active="true"]').forEach(e=>e.removeAttribute("data-custup-icon-active")),e.currentTarget.dataset.custupIconActive="true",u.innerHTML=e.currentTarget.innerHTML,u.querySelector("div")?.remove(),h()},f=()=>{this._custupSidebarLeftEl.innerHTML="";var e,t,i=document.createElement("div");l=i,I()?(this._custupDefaultUIInnerContentEl.innerHTML="",e=this.get_file_sources(),i.innerHTML=this.ui_icons.mobile_device,i.classList.add("file-source"),(t=document.createElement("div")).innerHTML="Select from Device",i.appendChild(t),i.onclick=e=>this.select_file_from_device(e),this._custupDefaultUIInnerContentEl.append(i),e.map(e=>{e.classList.add("file-source");var t=document.createElement("div");t.innerHTML=e.title,e.append(t),e.addEventListener("click",m),this._custupDefaultUIInnerContentEl.append(e)}),this.set_scroll_pointer_event(this._custupDefaultUIEl,this._custupDefaultUIInnerContentEl),r.style.display="flex"):(r.style.display="none",this._custupDefaultUIInnerContentEl.innerHTML=this.options._custupDefaultUploadSentence,i.innerHTML=this.ui_icons.desktop_device,this._custupSidebarLeftEl.append(i),i.dataset.custupIconActive="true",i.onclick=e=>o(e)),I()||this.get_file_sources(this._custupSidebarLeftEl,m)};f(),window.onresize=e=>{f()},this.on("file_source.closed",()=>{this._custupEl.querySelectorAll('[data-custup-icon-active="true"]').forEach(e=>e.removeAttribute("data-custup-icon-active")),u.innerHTML=I()?"Select from":this.ui_icons.desktop_device,0<this.get_total_file_count()&&_()}),this.on("file.afterAdded",({file:t,element:e,count:i})=>{d||c();var n=document.createElement("div"),l=(n.className="EUIFileDetailsContainer",document.createElement("div")),o=(l.className="EUIFilenameSizeContainer",document.createElement("div")),r=(o.innerHTML=t.name,document.createElement("div")),o=(r.innerHTML=this.parseFileSize(t.size),l.appendChild(o),l.appendChild(r),document.createElement("div")),r=(o.className="EUIFileDisplayToolsContainer",document.createElement("div")),s=(r.innerHTML=this.ui_icons.cancel,r.onclick=e=>{this.remove_file(t.id)},document.createElement("div")),a=(s.innerHTML=this.ui_icons.eye,s.onclick=e=>{this.preview_file(t.id)},document.createElement("div")),a=(a.innerHTML=this.ui_icons.retry,a.id="retry_"+t.id,a.style.display="none",a.onclick=e=>{this.retry_upload(t.id)},o.appendChild(a),this.is_file_previewable(t)&&o.appendChild(s),o.appendChild(r),document.createElement("div")),s=(a.className="EUIProgressIndicatorContainer",document.createElement("div"));a.appendChild(s),n.appendChild(l),n.appendChild(o),e.appendChild(n),e.appendChild(a),u.innerHTML="Selected Files "+i,_()}),this.on("file.all_removed",e=>{t(),u.innerHTML=I()?"Select from":this.ui_icons.desktop_device,h(),setTimeout(()=>{f()},100)}),this.on("file.removed",e=>{u.innerHTML="Selected Files "+e.files_count}),this.on("upload.error",e=>{this._custupEl.querySelector("#"+e.file.id).querySelector('[id*="retry_"]').style.display="flex",n.innerHTML="Upload",n.disabled=!1}),this.on("upload.retry",e=>{this._custupEl.querySelector("#"+e.file.id).querySelector('[id*="retry_"]').style.display="none"}),this.on("upload.progress",e=>{var t,i;this.options.single_upload||(i=(t=this._custupEl.querySelector("#"+e.file.id)).querySelector(".EUIFilenameSizeContainer div:last-child"),t.querySelector(".EUIProgressIndicatorContainer div").style.width=100*e.progressEvent.progress+"%",i.innerHTML=this.parseFileSize(e.progressEvent.loaded)+" / "+this.parseFileSize(e.progressEvent.total))}),this.on("upload.beforeStart",e=>{n.innerHTML="Uploading...",n.disabled=!0}),this.on("upload.all_finished",e=>{n.innerHTML="Upload",n.disabled=!1}),this.on("default_ui.closed",()=>{this._custupEl.querySelectorAll('[data-custup-icon-active="true"]').forEach(e=>e.removeAttribute("data-custup-icon-active")),u.innerHTML="Selected Files",0<this.get_total_file_count()&&_(),c()})})}}